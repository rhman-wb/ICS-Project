# 智能检核引擎需求文档

## 概述

本模块是系统的核心，负责执行多层次的智能检核任务，整合传统匹配、语义分析和LLM深度理解能力，为用户提供准确高效的文档检核服务。

## 用户故事

### 1. 多层检核架构执行

**用户故事**: 作为系统用户，我希望系统能够采用多层次的检核策略，从简单到复杂逐步分析文档，确保检核的准确性和效率。

#### 验收标准
1. 当执行检核任务时，系统应首先进行L1关键词精确匹配，快速识别明显问题
2. 当L1检核完成后，系统应进行L2语义相似度匹配，识别意思相近的表述
3. 当L2检核完成后，系统应进行L3 LLM深度语义理解，处理复杂的语义问题
4. 当某一层检核发现问题时，系统应记录问题来源和置信度
5. 当所有层次检核完成时，系统应融合结果并生成综合报告

### 2. 关键词精确匹配（L1）

**用户故事**: 作为系统用户，我希望系统能够快速识别文档中的关键词匹配问题，为后续深度分析提供基础。

#### 验收标准
1. 当执行关键词匹配时，系统应支持完全匹配和正则表达式匹配
2. 当匹配到目标关键词时，系统应记录匹配位置、上下文和匹配类型
3. 当处理大文档时，关键词匹配应在5秒内完成
4. 当关键词匹配失败时，系统应继续执行后续检核层次
5. 当匹配结果较多时，系统应按重要性和位置进行排序

### 3. 语义相似度匹配（L2）

**用户故事**: 作为系统用户，我希望系统能够识别意思相似但表述不同的文本内容，避免因用词差异导致的漏检。

#### 验收标准
1. 当执行语义匹配时，系统应使用预训练的向量模型计算文本相似度
2. 当相似度超过设定阈值时，系统应将其标记为潜在问题
3. 当计算相似度时，系统应考虑上下文语境的影响
4. 当处理保险专业术语时，系统应使用领域特定的向量模型
5. 当相似度计算完成时，系统应提供相似度分数和匹配依据

### 4. LLM深度语义理解（L3）

**用户故事**: 作为系统用户，我希望系统能够利用大语言模型的能力，理解复杂的语义关系和逻辑问题。

#### 验收标准
1. 当前两层检核无法确定问题时，系统应调用LLM进行深度分析
2. 当LLM分析文本时，系统应使用专门的保险领域提示词
3. 当LLM给出判断时，系统应要求其提供详细的分析理由
4. 当LLM响应时间过长时，系统应设置超时机制并记录异常
5. 当LLM分析完成时，系统应验证结果的合理性并记录置信度

### 5. 检核任务调度与执行

**用户故事**: 作为系统用户，我希望系统能够高效地调度和执行检核任务，支持单个和批量文档的处理。

#### 验收标准
1. 当用户提交检核任务时，系统应创建任务队列并分配唯一的任务ID
2. 当执行单个文档检核时，系统应在100秒内完成（包含5个要件）
3. 当执行批量检核时，系统应支持并行处理以提高效率
4. 当任务执行过程中出现错误时，系统应记录错误信息并继续处理其他任务
5. 当任务完成时，系统应通知用户并提供结果查看链接

### 6. 结果融合与置信度计算

**用户故事**: 作为系统用户，我希望系统能够智能地融合多层检核结果，提供准确的问题判断和置信度评估。

#### 验收标准
1. 当多层检核都发现同一问题时，系统应提高该问题的置信度
2. 当不同层次给出冲突结果时，系统应根据规则优先级和历史准确率进行判断
3. 当计算置信度时，系统应考虑规则类型、匹配程度、上下文等因素
4. 当置信度较低时，系统应标记为"需人工确认"
5. 当融合结果时，系统应保留各层次的原始检核信息供追溯

### 7. 异步处理机制

**用户故事**: 作为系统用户，我希望系统能够异步处理检核任务，避免长时间等待并支持任务进度查看。

#### 验收标准
1. 当提交检核任务时，系统应立即返回任务ID而不阻塞用户操作
2. 当任务执行过程中，系统应实时更新任务进度和状态
3. 当用户查询任务状态时，系统应提供详细的进度信息和预计完成时间
4. 当任务完成时，系统应发送通知（页面提示或邮件）
5. 当系统重启时，未完成的任务应能够自动恢复执行

### 8. 检核进度跟踪

**用户故事**: 作为系统用户，我希望能够实时查看检核任务的执行进度，了解当前处理状态。

#### 验收标准
1. 当任务开始执行时，系统应显示"正在处理"状态和当前进度百分比
2. 当处理多个文档时，系统应显示已完成和总数量的对比
3. 当执行不同检核层次时，系统应显示当前执行的层次名称
4. 当遇到错误时，系统应在进度中标注错误信息但继续处理
5. 当任务完成时，系统应显示总耗时和处理结果摘要

## 非功能需求

### 性能要求
- 单个文档检核时间不超过20秒
- 单个产品（5个要件）检核时间不超过100秒
- 支持并发检核任务数不少于10个
- 系统响应时间不超过3秒

### 可靠性要求
- 检核准确率不低于90%
- 系统可用性不低于99.5%
- 支持任务失败重试机制
- 提供完整的错误日志和恢复机制

### 扩展性要求
- 支持新检核算法的插件式扩展
- 支持检核规则的动态加载和更新
- 支持分布式部署和水平扩展